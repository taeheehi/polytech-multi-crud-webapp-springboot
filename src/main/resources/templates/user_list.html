<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>회원 목록</title>

  <!-- ✅ 공통 스타일 -->
  <link rel="stylesheet" href="/home.css">
  <!-- ✅ 테이블 전용 스타일 -->
  <link rel="stylesheet" href="/user_list.css">
</head>
<body>

  <!-- ✅ 상단 네비게이션 바 -->
  <header class="navbar">
    <div class="nav-left">
      <a href="/" class="logo">홈페이지</a>
    </div>
    <div class="nav-right" id="nav-right">
      <!-- JS에서 로그인 상태에 따라 동적으로 출력됨 -->
    </div>
  </header>

  <!-- ✅ 본문 콘텐츠 -->
  <main class="list-container">
    <h2>📋 전체 회원 목록 (관리자 전용)</h2>

    <table class="user-table">
      <thead>
        <tr>
          <th>번호</th>
          <th>권한</th>
          <th>ID</th>
          <th>이름</th>
          <th>연락처</th>
          <th>주소</th>
          <th>가입일</th>
          <th>수정일</th>
        </tr>
      </thead>
      <tbody id="userTableBody">
        <!-- 🔁 JS에서 fetch로 동적으로 채움 -->
      </tbody>
    </table>

    <div class="button-area">
      <a href="/" class="back-btn">← 돌아가기</a>
    </div>
  </main>

  <!-- ✅ JavaScript: 로그인 세션 + 회원 목록 동적 처리 -->
  <script>
    // 🔐 로그인 상태 확인 후 상단 메뉴 렌더링
    fetch("/sessionCheck")
      .then(res => res.json())
      .then(data => {
        let html = "";
        if (data.is_login) {
          html += `<span>${data.login_id}님</span>`;
          html += `<a href="/mypage">마이페이지</a>`;
          if (data.user_type === "admin") {
            html += `<a href="/user_list">회원관리</a>`;
          }
          html += `<a href="/logout">로그아웃</a>`;
        } else {
          html += `<a href="/login">로그인</a>`;
          html += `<a href="/join">회원가입</a>`;
        }
        document.getElementById("nav-right").innerHTML = html;
      });
                                                                     
    // 📋 회원 목록 불러오기
    fetch("/getUsersJson")
      .then(res => res.json())
      .then(users => {
        let html = "";
        users.forEach((u, i) => {
          html += `
            <tr>
              <td>${i + 1}</td>
              <td>${u.userType}</td>
              <td>${u.id}</td>
              <td>${u.name}</td>
              <td>${u.phone}</td>
              <td>${u.address}</td>
              <td>${u.created}</td>
              <td>${u.lastUpdated}</td>
            </tr>
          `;
        });
        document.querySelector("#userTableBody").innerHTML = html;
      });
  </script>

</body>
</html>
